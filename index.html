<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Intelligent Data Logic Search</title>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.63.1/build/stlite.css" />
</head>
<body>
    <div id="root"></div>
    <script src="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.63.1/build/stlite.js"></script>
    <script>
    stlite.mount({
        entrypoint: "app.py",
        files: {
        "app.py": `
import streamlit as st
import json
from pyodide.http import open_url

st.set_page_config(page_title="Data Logic", layout="wide")

# 1. The Intelligence: Defining the Search logic
# In a real app, this 'data' would be loaded from a static JSON file in your repo
docs = [
    {"title": "Revenue Transformation", "tags": "Finance, Sales", "content": "Calculates Gross Revenue using SUM(price * quantity)."},
    {"title": "Customer Churn", "tags": "Retention, Marketing", "content": "Identifies users inactive for 90 days using DATEDIFF."},
    {"title": "Tax Compliance", "tags": "Finance, Legal", "content": "Applies VAT/GST based on country_code."}
]

st.title("üîç Intelligent Data Portal")
st.markdown("### Search 400+ SQL Logic files with typo tolerance")

query = st.text_input("Search by metric, table, or logic...", placeholder="Try typing 'revnue' or 'churn'")

if query:
    # We pass the query to Javascript's Fuse.js for 'Smart' processing
    import js
    options = js.JSON.parse('{"keys": [{"name": "title", "weight": 2}, "content", "tags"], "threshold": 0.3}')
    fuse = js.Fuse.new(js.JSON.parse(json.dumps(docs)), options)
    results = fuse.search(query)
    
    if results:
        st.write(f"Found {len(results)} matches:")
        for res in results:
            item = res.item
            with st.expander(f"üìÑ {item.title}"):
                st.info(f"**Tags:** {item.tags}")
                st.markdown(item.content)
    else:
        st.warning("No results found. Try a different term.")
        `
        }
    }, document.getElementById("root"));
    </script>
</body>
</html>
